<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
  <script>
    $(document).ready(function () {
      $("#CloseShowNote").click(function () {
        $(".showData").removeClass("div-popup-active");
      });

      $("#ShowNoteData").on("input", function () {
        $(this).css("height", "auto");
        let newHeight = Math.min(this.scrollHeight, 300);
        $(this).css("height", newHeight + "px");
      });
      $("#Messages").on("input", function () {
        $(this).css("height", "auto");
        let newHeight = Math.min(this.scrollHeight, 300);
        $(this).css("height", newHeight + "px");
      });

      var popup = $("#popupItm");
      var btn = $("#AddNote");
      var closebtn = $(".popupCloseButton");
      var blur = document.getElementById("blur");
      popup.hide();
      btn.click(function () {
        popup.show();
        blur.classList.toggle("blur-div");
      });
      closebtn.click(function () {
        popup.hide();
        blur.classList.remove("blur-div");
      });

      $("#popupItm").on("submit", function (e) {
        e.preventDefault();
        $.ajax({
          url: "save-note.php",
          type: "POST",
          dataType: "json",
          data: {
            Title: $("#Title").val(),
            Messages: $("#Messages").val(),
          },
          success: function (response) {
            if (response.status === "success") {
              $(".error").css("color", "green");
              $(".error").html(response.message);
            } else {
              $(".error").css("color", "red");
              $(".error").html(response.message);
            }
            popup.hide();
            blur.classList.remove("blur-div");
          },
          error: function (xhr, status, error) {
            console.log("Error:", error);
            $(".error").html("An error occurred");
          },
        });
      });
      // Handle form submission
      $("#Update_").on("submit", function (event) {
        event.preventDefault(); // Prevent the default form submission
        var formData = $(this).serialize();
        // Process the form data (e.g., send it via AJAX)
        $.ajax({
          type: "POST",
          url: "update-note.php",
          data: formData,
          success: function (response) {
            location.reload();
          },
          error: function (error) {
            // Handle any errors
            alert("An error occurred. Please try again.");
            console.log(error);
          },
        });
      });
    });

    function showDetails(note) {
      let id = note.getAttribute("data-id");
      $.ajax({
        url: "showNote.php",
        type: "POST",
        data: { id: id },
        success: function (response) {
          var popup = $("#Show_data_div");
          var blur = document.getElementById("blur");
          var data = JSON.parse(response);
          if (data) {
            $("#NoteTitle").text(data.titles);
            $("#ShowNoteData").val(data.messages);
            $("#ID").val(id);
            popup.toggleClass("div-popup-active");
          } else {
            $(".error").html("<p>Error parsing JSON.</p>");
          }
        },
      });
    }
  </script>
</html>
